<!DOCTYPE html>

<html lang="en-US">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Listing12_DrawPlatformLine</title>
  <script src="../../jsgame0.js"></script>
  <style type="text/css" media="screen">
body {
  background-color: white;
  color: black;
}
.hidden {
  display: none;
}
#original {
  margin-left: 1em;
}
  </style>
</head>

<body>
<section id="imageLoader" class="hidden">
  <img class="hidden" src="images/bee_1_left.png" alt="bee_1_left" data-name="bee_1_left">
  <img class="hidden" src="images/bee_1_right.png" alt="bee_1_right" data-name="bee_1_right">
  <img class="hidden" src="images/bee_2_left.png" alt="bee_2_left" data-name="bee_2_left">
  <img class="hidden" src="images/bee_2_right.png" alt="bee_2_right" data-name="bee_2_right">
  <img class="hidden" src="images/bee_3_left.png" alt="bee_3_left" data-name="bee_3_left">
  <img class="hidden" src="images/bee_3_right.png" alt="bee_3_right" data-name="bee_3_right">
  <img class="hidden" src="images/collectable_1.png" alt="collectable_1" data-name="collectable_1">
  <img class="hidden" src="images/collectable_2.png" alt="collectable_2" data-name="collectable_2">
  <img class="hidden" src="images/collectable_3.png" alt="collectable_3" data-name="collectable_3">
  <img class="hidden" src="images/collectable_4.png" alt="collectable_4" data-name="collectable_4">
  <img class="hidden" src="images/collectable_5.png" alt="collectable_5" data-name="collectable_5">
  <img class="hidden" src="images/collectable_rainbow.png" alt="collectable_rainbow" data-name="collectable_rainbow">
  <img class="hidden" src="images/falling_rainbow.png" alt="falling_rainbow" data-name="falling_rainbow">
  <img class="hidden" src="images/flying_candy_1.png" alt="flying_candy_1" data-name="flying_candy_1">
  <img class="hidden" src="images/flying_candy_2.png" alt="flying_candy_2" data-name="flying_candy_2">
  <img class="hidden" src="images/flying_candy_3.png" alt="flying_candy_3" data-name="flying_candy_3">
  <img class="hidden" src="images/flying_candy_4.png" alt="flying_candy_4" data-name="flying_candy_4">
  <img class="hidden" src="images/green_worm_left.png" alt="green_worm_left" data-name="green_worm_left">
  <img class="hidden" src="images/green_worm_right.png" alt="green_worm_right" data-name="green_worm_right">
  <img class="hidden" src="images/platform_cloud_1.png" alt="platform_cloud_1" data-name="platform_cloud_1">
  <img class="hidden" src="images/platform_cloud_2.png" alt="platform_cloud_2" data-name="platform_cloud_2">
  <img class="hidden" src="images/platform_cloud_3.png" alt="platform_cloud_3" data-name="platform_cloud_3">
  <img class="hidden" src="images/platform_grass_1.png" alt="platform_grass_1" data-name="platform_grass_1">
  <img class="hidden" src="images/platform_grass_2.png" alt="platform_grass_2" data-name="platform_grass_2">
  <img class="hidden" src="images/platform_grass_3.png" alt="platform_grass_3" data-name="platform_grass_3">
  <img class="hidden" src="images/platform_grass_4.png" alt="platform_grass_4" data-name="platform_grass_4">
  <img class="hidden" src="images/platform_rock_1.png" alt="platform_rock_1" data-name="platform_rock_1">
  <img class="hidden" src="images/platform_rock_2.png" alt="platform_rock_2" data-name="platform_rock_2">
  <img class="hidden" src="images/platform_rock_3.png" alt="platform_rock_3" data-name="platform_rock_3">
  <img class="hidden" src="images/platform_rock_4.png" alt="platform_rock_4" data-name="platform_rock_4">
  <img class="hidden" src="images/platform_tree_1.png" alt="platform_tree_1" data-name="platform_tree_1">
  <img class="hidden" src="images/platform_tree_2.png" alt="platform_tree_2" data-name="platform_tree_2">
  <img class="hidden" src="images/platform_tree_3.png" alt="platform_tree_3" data-name="platform_tree_3">
  <img class="hidden" src="images/platform_tree_4.png" alt="platform_tree_4" data-name="platform_tree_4">
  <img class="hidden" src="images/platform_tree_5.png" alt="platform_tree_5" data-name="platform_tree_5">
  <img class="hidden" src="images/player_collided_1.png" alt="player_collided_1" data-name="player_collided_1">
  <img class="hidden" src="images/player_collided_2.png" alt="player_collided_2" data-name="player_collided_2">
  <img class="hidden" src="images/player_icon.png" alt="player_icon" data-name="player_icon">
  <img class="hidden" src="images/player_jump_down_left.png" alt="player_jump_down_left" data-name="player_jump_down_left">
  <img class="hidden" src="images/player_jump_down_right.png" alt="player_jump_down_right" data-name="player_jump_down_right">
  <img class="hidden" src="images/player_jump_up_left.png" alt="player_jump_up_left" data-name="player_jump_up_left">
  <img class="hidden" src="images/player_jump_up_right.png" alt="player_jump_up_right" data-name="player_jump_up_right">
  <img class="hidden" src="images/player_stand_left.png" alt="player_stand_left" data-name="player_stand_left">
  <img class="hidden" src="images/player_stand_right.png" alt="player_stand_right" data-name="player_stand_right">
  <img class="hidden" src="images/player_walk_1_left.png" alt="player_walk_1_left" data-name="player_walk_1_left">
  <img class="hidden" src="images/player_walk_1_right.png" alt="player_walk_1_right" data-name="player_walk_1_right">
  <img class="hidden" src="images/player_walk_2_left.png" alt="player_walk_2_left" data-name="player_walk_2_left">
  <img class="hidden" src="images/player_walk_2_right.png" alt="player_walk_2_right" data-name="player_walk_2_right">
  <img class="hidden" src="images/rainbow.png" alt="rainbow" data-name="rainbow">
  <img class="hidden" src="images/red_worm_left.png" alt="red_worm_left" data-name="red_worm_left">
  <img class="hidden" src="images/red_worm_right.png" alt="red_worm_right" data-name="red_worm_right">
</section>

<main>
<h1>Listing12_DrawPlatformLine</h1>

<canvas id="screen">
The game screen appears here if your browser supports the Canvas API.
</canvas>
<section id="controls">
  <button type="button" id="reset">Reset</button>
  <button type="button" id="pause">Pause</button>
</section>

<pre id="output"></pre>

<h2>Attribution</h2>

<p><a href="https://wireframe.raspberrypi.com/issues/57">Make your own retro platformer, pages 50-55, by Jordi Sontanja</a>.</p>

<p>Licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/legalcode">Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported</a>.</p>

<h2>Original Python code</h2>

<pre id="original"><code>
# Draw platforms program:
# - Mouse click: add line to current platform
# - Delete or Backspace: delete last line
# - Cursor Left and Right: select previous or next platform
# - Space: print the platforms
import pgzrun
from pygame import image, Color, Surface

platformNames = [&#x27;platform_rock_1&#x27;, &#x27;platform_rock_2&#x27;, &#x27;platform_rock_3&#x27;, &#x27;platform_rock_4&#x27;,
                 &#x27;platform_grass_1&#x27;, &#x27;platform_grass_2&#x27;, &#x27;platform_grass_3&#x27;, &#x27;platform_grass_4&#x27;,
                 &#x27;platform_tree_1&#x27;, &#x27;platform_tree_2&#x27;, &#x27;platform_tree_3&#x27;, &#x27;platform_tree_4&#x27;, &#x27;platform_tree_5&#x27;,
                 &#x27;platform_cloud_1&#x27;, &#x27;platform_cloud_2&#x27;, &#x27;platform_cloud_3&#x27;]

platforms = [Actor(platformNames[i], (800//2, 600//2)) for i in range(len(platformNames))]
lines = [[] for i in range(len(platformNames))]

activePlatform = 0
usePoint = False
lastPoint = (0,0)

def draw():
    screen.clear()
    platforms[activePlatform].draw()
    for i in range(1, len(lines[activePlatform])):
        screen.draw.line(lines[activePlatform][i-1], lines[activePlatform][i], (128,128,255))
    if usePoint and len(lines[activePlatform]) &gt; 0:
        screen.draw.line(lines[activePlatform][len(lines[activePlatform])-1], lastPoint, (128,128,255))

def update(dt):
    pass

def on_mouse_down(pos, button):
    global usePoint, lastPoint
    usePoint = True
    lastPoint = pos

def on_mouse_up(pos):
    global usePoint
    lines[activePlatform].append(pos)
    usePoint = False

def on_mouse_move(pos):
    global lastPoint
    lastPoint = pos

def on_key_down(key):
    global activePlatform
    if key == keys.SPACE:
        displacedLines = [[(lines[i][j][0] - 400, lines[i][j][1] - 300) for j in range(len(lines[i]))] for i in range(len(lines))]
        print(str(displacedLines))
    elif key == keys.LEFT:
        activePlatform = (activePlatform - 1 + len(platformNames)) % len(platformNames);
    elif key == keys.RIGHT:
        activePlatform = (activePlatform + 1) % len(platformNames);
    elif len(lines[activePlatform]) &gt; 0 and (key == keys.BACKSPACE or key == keys.DELETE):
        lines[activePlatform].pop(len(lines[activePlatform]) - 1)

pgzrun.go()
</code></pre>
</main>

<script>
/*
 * Draw platforms program:
 * - Mouse click: add line to current platform
 * - Delete or Backspace: delete last line
 * - Cursor Left and Right: select previous or next platform
 * - Space: print the platforms
 */

const output = document.querySelector('#output');

const PLATFORM_NAMES = ['platform_rock_1', 'platform_rock_2', 'platform_rock_3', 'platform_rock_4',
                        'platform_grass_1', 'platform_grass_2', 'platform_grass_3', 'platform_grass_4',
                        'platform_tree_1', 'platform_tree_2', 'platform_tree_3', 'platform_tree_4', 'platform_tree_5',
                        'platform_cloud_1', 'platform_cloud_2', 'platform_cloud_3'];

var lines, activePlatform, usePoint, lastPoint;

function reset() {
  lines = new Map();
  for (let name of PLATFORM_NAMES) {
    lines.set(name, []);
  }

  activePlatform = 0;
  usePoint = false;
  lastPoint = [0, 0];
}

function draw() {
  screen.clear();
  let actor = new Actor(PLATFORM_NAMES[activePlatform]),
      platformLines = lines.get(PLATFORM_NAMES[activePlatform]);
  actor.pos = [Math.floor(800 / 2), Math.floor(600 / 2)];
  actor.draw();
  for (let i = 1; i < platformLines.length; i++) {
    screen.draw.line(platformLines[i-1], platformLines[i], [128, 128, 255]);
  }
  let length = platformLines.length;
  if (usePoint && (length > 0)) {
    screen.draw.line(platformLines[length-1], lastPoint, [128, 128, 255]);
  }
}

function on_mouse_down(pos, button) {
  usePoint = true;
  lastPoint = pos;
}

function on_mouse_up(pos) {
  lines.get(PLATFORM_NAMES[activePlatform]).push(pos);
  usePoint = false;
}

function on_mouse_move(pos) {
  lastPoint = pos;
}

function on_key_down(key) {
  if (key === keys.SPACE) {
    let outputObject = {
      enemies: {},
      platforms: {}
    },
        platformLines;
    for (let name of PLATFORM_NAMES) {
      platformLines = lines.get(name);
      outputObject['platforms'][name] = {
        lines: platformLines.map(c => [c[0] - 400, c[1] - 300])
      };
    }
    console.log(JSON.stringify(outputObject, null, 2));
    output.textContent = JSON.stringify(outputObject, null, 2);
  }
  else if (key === keys.LEFT) {
    activePlatform = (activePlatform - 1 + PLATFORM_NAMES.length) % PLATFORM_NAMES.length;
  }
  else if (key === keys.RIGHT) {
    activePlatform = (activePlatform + 1) % PLATFORM_NAMES.length;
  }
  else if ((lines.get(PLATFORM_NAMES[activePlatform]).length > 0) && ((key === keys.BACKSPACE) || (key === keys.DELETE))) {
    lines.get(PLATFORM_NAMES[activePlatform]).pop();
  }
}

window.addEventListener('load', (event) => {
  images.LOAD('#imageLoader img');
  reset();
  screen.set_mode('#screen', '#reset', '#pause');
});
</script>
</body>

</html>
