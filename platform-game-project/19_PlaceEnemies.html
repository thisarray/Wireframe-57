<!DOCTYPE html>

<html lang="en-US">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Listing19_PlaceEnemies</title>
  <script src="../../jsgame0.js"></script>
  <script id="level" type="application/json">
{
  "enemies": {
    "bee_1_left": [
      [623, -2798],
      [675, -3376],
      [674, -3624],
      [647, -3930],
      [690, -4193]
    ],
    "bee_1_right": [
      [169, -2724],
      [132, -3378],
      [120, -3621],
      [136, -3914],
      [132, -4189]
    ],
    "green_worm_left": [
      [645, 227],
      [383, 69],
      [228, -67],
      [334, -920],
      [396, -1247],
      [390, -1666],
      [343, -2033],
      [457, -2034],
      [619, -1874],
      [737, -1876],
      [181, -2640],
      [333, -2896]
    ],
    "green_worm_right": [
      [111, 379],
      [548, -69],
      [387, -247],
      [378, -647],
      [449, -921],
      [399, -1473],
      [74, -1879],
      [174, -1880]
    ],
    "red_worm_left": [
      [218, -1083],
      [196, -2379],
      [743, -3552],
      [779, -3814],
      [393, -4229]
    ],
    "red_worm_right": [
      [603, -1080],
      [717, -2339],
      [57, -3536],
      [23, -3826],
      [414, -4228]
    ]
  },
  "platforms": {
    "platform_cloud_1": {
      "lines": [
        [-114, -4],
        [-82, -14],
        [-39, -17],
        [-12, -33],
        [37, -35],
        [52, -22],
        [87, -18],
        [113, -8]
      ],
      "pos": [
        [125, -3501],
        [668, -3511],
        [409, -3921]
      ]
    },
    "platform_cloud_2": {
      "lines": [
        [-158, -4],
        [-119, -8],
        [-72, -23],
        [-45, -19],
        [-4, -35],
        [24, -23],
        [61, -22],
        [84, -8],
        [130, -11],
        [159, 1]
      ],
      "pos": [
        [192, -3219],
        [618, -3221],
        [397, -3378],
        [396, -3614],
        [181, -4025],
        [645, -4034],
        [404, -4173]
      ]
    },
    "platform_cloud_3": {
      "lines": [
        [-237, -5],
        [-216, -15],
        [-168, -14],
        [-139, -29],
        [-92, -27],
        [-49, -42],
        [7, -21],
        [31, -40],
        [61, -41],
        [84, -22],
        [141, -33],
        [180, -12],
        [237, 1]
      ],
      "pos": [
        [219, -3039],
        [659, -3036],
        [120, -3774],
        [690, -3766],
        [183, -4361],
        [621, -4356]
      ]
    },
    "platform_grass_1": {
      "lines": [
        [-145, -8],
        [-129, -22],
        [-89, -37],
        [-18, -29],
        [52, -36],
        [104, -28],
        [146, -8]
      ],
      "pos": [
        [396, -1622],
        [402, -1983]
      ]
    },
    "platform_grass_2": {
      "lines": [
        [-153, -8],
        [-131, -16],
        [-100, -16],
        [-22, -10],
        [44, -16],
        [95, -8],
        [150, -1]
      ],
      "pos": [
        [400, -1219]
      ]
    },
    "platform_grass_3": {
      "lines": [
        [-166, -12],
        [-152, -23],
        [-97, -29],
        [-22, -17],
        [24, -18],
        [82, -29],
        [142, -25],
        [166, -17]
      ],
      "pos": [
        [147, -728],
        [454, -731],
        [697, -736],
        [258, -878],
        [559, -878],
        [109, -1039],
        [704, -1036],
        [400, -1439],
        [119, -1841],
        [676, -1833],
        [128, -2144],
        [429, -2146],
        [720, -2149]
      ]
    },
    "platform_grass_4": {
      "lines": [
        [-51, 1],
        [-39, -12],
        [-13, -21],
        [22, -22],
        [51, -9]
      ],
      "pos": [
        [113, -1335],
        [708, -1334],
        [166, -1533],
        [647, -1535],
        [110, -1719],
        [680, -1729]
      ]
    },
    "platform_rock_1": {
      "lines": [
        [-194, -23],
        [-182, -32],
        [-138, -35],
        [-104, -38],
        [-80, -43],
        [-15, -34],
        [34, -36],
        [59, -42],
        [93, -37],
        [126, -28],
        [181, -26],
        [192, -24]
      ],
      "pos": [
        [663, 433],
        [119, 429],
        [121, 273],
        [654, 278]
      ]
    },
    "platform_rock_2": {
      "lines": [
        [-134, -25],
        [-98, -31],
        [-37, -37],
        [25, -35],
        [98, -34],
        [131, -25]
      ],
      "pos": [
        [386, 122],
        [391, -594]
      ]
    },
    "platform_rock_3": {
      "lines": [
        [-59, -10],
        [-29, -27],
        [-1, -34],
        [36, -29],
        [56, -15]
      ],
      "pos": [
        [98, -337],
        [684, -339],
        [289, -403],
        [505, -404],
        [90, -537],
        [684, -546]
      ]
    },
    "platform_rock_4": {
      "lines": [
        [-174, -19],
        [-137, -35],
        [-93, -34],
        [-1, -28],
        [78, -38],
        [171, -30]
      ],
      "pos": [
        [676, 599],
        [403, 597],
        [90, 599],
        [243, -23],
        [547, -25],
        [391, -203]
      ]
    },
    "platform_tree_1": {
      "lines": [
        [-166, -38],
        [-135, -46],
        [-96, -40],
        [-62, -20],
        [-30, 9],
        [-8, 20],
        [16, 25],
        [92, 16],
        [145, 18],
        [166, 23]
      ],
      "pos": [
        [161, -2536]
      ]
    },
    "platform_tree_2": {
      "lines": [
        [-165, 10],
        [-110, -5],
        [-66, -21],
        [-23, -41],
        [16, -51],
        [63, -51],
        [124, -29],
        [162, -25]
      ],
      "pos": [
        [153, -2310],
        [154, -2779]
      ]
    },
    "platform_tree_3": {
      "lines": [
        [-47, -9],
        [-5, -25],
        [66, -30]
      ],
      "pos": [
        [131, -2594],
        [700, -2919],
        [284, -2851]
      ]
    },
    "platform_tree_4": {
      "lines": [
        [-134, -18],
        [-84, 2],
        [-57, 1],
        [25, -20],
        [62, -18],
        [85, -12],
        [133, -14]
      ],
      "pos": [
        [677, -2302],
        [687, -2701]
      ]
    },
    "platform_tree_5": {
      "lines": [
        [-147, -45],
        [-122, -48],
        [-66, -59],
        [-21, -58],
        [18, -42],
        [53, -13],
        [109, 13],
        [143, 20]
      ],
      "pos": [
        [665, -2511],
        [660, -2841]
      ]
    }
  }
}
  </script>
  <style type="text/css" media="screen">
body {
  background-color: white;
  color: black;
}
.hidden {
  display: none;
}
#original {
  margin-left: 1em;
}
  </style>
</head>

<body>
<section id="imageLoader" class="hidden">
  <img class="hidden" src="images/bee_1_left.png" alt="bee_1_left" data-name="bee_1_left">
  <img class="hidden" src="images/bee_1_right.png" alt="bee_1_right" data-name="bee_1_right">
  <img class="hidden" src="images/bee_2_left.png" alt="bee_2_left" data-name="bee_2_left">
  <img class="hidden" src="images/bee_2_right.png" alt="bee_2_right" data-name="bee_2_right">
  <img class="hidden" src="images/bee_3_left.png" alt="bee_3_left" data-name="bee_3_left">
  <img class="hidden" src="images/bee_3_right.png" alt="bee_3_right" data-name="bee_3_right">
  <img class="hidden" src="images/collectable_1.png" alt="collectable_1" data-name="collectable_1">
  <img class="hidden" src="images/collectable_2.png" alt="collectable_2" data-name="collectable_2">
  <img class="hidden" src="images/collectable_3.png" alt="collectable_3" data-name="collectable_3">
  <img class="hidden" src="images/collectable_4.png" alt="collectable_4" data-name="collectable_4">
  <img class="hidden" src="images/collectable_5.png" alt="collectable_5" data-name="collectable_5">
  <img class="hidden" src="images/collectable_rainbow.png" alt="collectable_rainbow" data-name="collectable_rainbow">
  <img class="hidden" src="images/falling_rainbow.png" alt="falling_rainbow" data-name="falling_rainbow">
  <img class="hidden" src="images/flying_candy_1.png" alt="flying_candy_1" data-name="flying_candy_1">
  <img class="hidden" src="images/flying_candy_2.png" alt="flying_candy_2" data-name="flying_candy_2">
  <img class="hidden" src="images/flying_candy_3.png" alt="flying_candy_3" data-name="flying_candy_3">
  <img class="hidden" src="images/flying_candy_4.png" alt="flying_candy_4" data-name="flying_candy_4">
  <img class="hidden" src="images/green_worm_left.png" alt="green_worm_left" data-name="green_worm_left">
  <img class="hidden" src="images/green_worm_right.png" alt="green_worm_right" data-name="green_worm_right">
  <img class="hidden" src="images/platform_cloud_1.png" alt="platform_cloud_1" data-name="platform_cloud_1">
  <img class="hidden" src="images/platform_cloud_2.png" alt="platform_cloud_2" data-name="platform_cloud_2">
  <img class="hidden" src="images/platform_cloud_3.png" alt="platform_cloud_3" data-name="platform_cloud_3">
  <img class="hidden" src="images/platform_grass_1.png" alt="platform_grass_1" data-name="platform_grass_1">
  <img class="hidden" src="images/platform_grass_2.png" alt="platform_grass_2" data-name="platform_grass_2">
  <img class="hidden" src="images/platform_grass_3.png" alt="platform_grass_3" data-name="platform_grass_3">
  <img class="hidden" src="images/platform_grass_4.png" alt="platform_grass_4" data-name="platform_grass_4">
  <img class="hidden" src="images/platform_rock_1.png" alt="platform_rock_1" data-name="platform_rock_1">
  <img class="hidden" src="images/platform_rock_2.png" alt="platform_rock_2" data-name="platform_rock_2">
  <img class="hidden" src="images/platform_rock_3.png" alt="platform_rock_3" data-name="platform_rock_3">
  <img class="hidden" src="images/platform_rock_4.png" alt="platform_rock_4" data-name="platform_rock_4">
  <img class="hidden" src="images/platform_tree_1.png" alt="platform_tree_1" data-name="platform_tree_1">
  <img class="hidden" src="images/platform_tree_2.png" alt="platform_tree_2" data-name="platform_tree_2">
  <img class="hidden" src="images/platform_tree_3.png" alt="platform_tree_3" data-name="platform_tree_3">
  <img class="hidden" src="images/platform_tree_4.png" alt="platform_tree_4" data-name="platform_tree_4">
  <img class="hidden" src="images/platform_tree_5.png" alt="platform_tree_5" data-name="platform_tree_5">
  <img class="hidden" src="images/player_collided_1.png" alt="player_collided_1" data-name="player_collided_1">
  <img class="hidden" src="images/player_collided_2.png" alt="player_collided_2" data-name="player_collided_2">
  <img class="hidden" src="images/player_icon.png" alt="player_icon" data-name="player_icon">
  <img class="hidden" src="images/player_jump_down_left.png" alt="player_jump_down_left" data-name="player_jump_down_left">
  <img class="hidden" src="images/player_jump_down_right.png" alt="player_jump_down_right" data-name="player_jump_down_right">
  <img class="hidden" src="images/player_jump_up_left.png" alt="player_jump_up_left" data-name="player_jump_up_left">
  <img class="hidden" src="images/player_jump_up_right.png" alt="player_jump_up_right" data-name="player_jump_up_right">
  <img class="hidden" src="images/player_stand_left.png" alt="player_stand_left" data-name="player_stand_left">
  <img class="hidden" src="images/player_stand_right.png" alt="player_stand_right" data-name="player_stand_right">
  <img class="hidden" src="images/player_walk_1_left.png" alt="player_walk_1_left" data-name="player_walk_1_left">
  <img class="hidden" src="images/player_walk_1_right.png" alt="player_walk_1_right" data-name="player_walk_1_right">
  <img class="hidden" src="images/player_walk_2_left.png" alt="player_walk_2_left" data-name="player_walk_2_left">
  <img class="hidden" src="images/player_walk_2_right.png" alt="player_walk_2_right" data-name="player_walk_2_right">
  <img class="hidden" src="images/rainbow.png" alt="rainbow" data-name="rainbow">
  <img class="hidden" src="images/red_worm_left.png" alt="red_worm_left" data-name="red_worm_left">
  <img class="hidden" src="images/red_worm_right.png" alt="red_worm_right" data-name="red_worm_right">
</section>

<main>
<h1>Listing19_PlaceEnemies</h1>

<canvas id="screen">
The game screen appears here if your browser supports the Canvas API.
</canvas>
<section id="controls">
  <button type="button" id="reset">Reset</button>
  <button type="button" id="pause">Pause</button>
</section>

<pre id="output"></pre>

<h2>Attribution</h2>

<p><a href="https://wireframe.raspberrypi.com/issues/57">Make your own retro platformer, pages 50-55, by Jordi Sontanja</a>.</p>

<p>Licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/legalcode">Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported</a>.</p>

<h2>Original Python code</h2>

<pre id="original"><code>
# Place platforms on play area
# - Mouse click: add the current enemy
# - Mouse secondary click: select next enemy
# - Cursor Left and Right: select previous or next enemy
# - Cursor Up and Down: displace the screen
# - Space: print the enemy positions
import pgzrun
from pygame import image, Color, Surface

platformNames = [&#x27;platform_rock_1&#x27;, &#x27;platform_rock_2&#x27;, &#x27;platform_rock_3&#x27;, &#x27;platform_rock_4&#x27;,
                 &#x27;platform_grass_1&#x27;, &#x27;platform_grass_2&#x27;, &#x27;platform_grass_3&#x27;, &#x27;platform_grass_4&#x27;,
                 &#x27;platform_tree_1&#x27;, &#x27;platform_tree_2&#x27;, &#x27;platform_tree_3&#x27;, &#x27;platform_tree_4&#x27;, &#x27;platform_tree_5&#x27;,
                 &#x27;platform_cloud_1&#x27;, &#x27;platform_cloud_2&#x27;, &#x27;platform_cloud_3&#x27;]

platforms = [(3,676,599),(3,403,597),(3,90,599),(0,663,433),(0,119,429),(0,121,273),(0,654,278),(1,386,122),
             (3,243,-23),(3,547,-25),(3,391,-203),(2,98,-337),(2,684,-339),(2,289,-403),(2,505,-404),(2,90,-537),
             (2,684,-546),(1,391,-594),(6,147,-728),(6,454,-731),(6,697,-736),(6,258,-878),(6,559,-878),(6,109,-1039),
             (6,704,-1036),(5,400,-1219),(7,113,-1335),(7,708,-1334),(6,400,-1439),(7,166,-1533),(7,647,-1535),
             (4,396,-1622),(7,110,-1719),(7,680,-1729),(6,119,-1841),(6,676,-1833),(4,402,-1983),(6,128,-2144),
             (6,429,-2146),(6,720,-2149),(9,153,-2310),(11,677,-2302),(12,665,-2511),(8,161,-2536),(10,131,-2594),
             (11,687,-2701),(9,154,-2779),(12,660,-2841),(10,700,-2919),(10,284,-2851),(15,219,-3039),(15,659,-3036),
             (14,192,-3219),(14,618,-3221),(14,397,-3378),(13,125,-3501),(13,668,-3511),(14,396,-3614),(15,120,-3774),
             (15,690,-3766),(13,409,-3921),(14,181,-4025),(14,645,-4034),(14,404,-4173),(15,183,-4361),(15,621,-4356),]

enemyNames = [[&#x27;green_worm_right&#x27;, &#x27;green_worm_left&#x27;],
              [&#x27;red_worm_right&#x27;, &#x27;red_worm_left&#x27;],
              [&#x27;bee_1_right&#x27;, &#x27;bee_1_left&#x27;,
               &#x27;bee_2_right&#x27;, &#x27;bee_2_left&#x27;,
               &#x27;bee_3_right&#x27;, &#x27;bee_3_left&#x27;]]

platformImages = [Actor(platformNames[i]) for i in range(len(platformNames))]

enemyImages = [Actor(enemyNames[i // 2][i % 2]) for i in range(len(enemyNames) * 2)]
enemies = []


activeEnemy = 0
currentPosition = (0,0)
currentY = 0

def draw():
    screen.clear()
    for platform in platforms:
        platformImages[platform[0]].x = platform[1]
        platformImages[platform[0]].y = platform[2] - currentY
        platformImages[platform[0]].draw()
    for enemy in enemies:
        enemy.draw()
    enemyImages[activeEnemy].draw()

def update(dt):
    enemyImages[activeEnemy].pos = currentPosition

def on_mouse_down(pos, button):
    global activeEnemy
    if mouse.LEFT == button:
        enemies.append(Actor(enemyNames[activeEnemy // 2][activeEnemy % 2], currentPosition))
    elif mouse.RIGHT == button:
        activeEnemy = (activeEnemy + 1) % len(enemyImages)

def on_mouse_move(pos):
    global currentPosition
    currentPosition = pos

def on_key_down(key):
    global currentY, activeEnemy
    if key == keys.UP:
        currentY -= 100
        for enemy in enemies:
            enemy.pos = (enemy.pos[0], enemy.pos[1] + 100)
    elif key == keys.DOWN and currentY &lt; 0:
        currentY += 100
        for enemy in enemies:
            enemy.pos = (enemy.pos[0], enemy.pos[1] - 100)
    elif key == keys.RIGHT:
        activeEnemy = (activeEnemy + 1) % len(enemyImages)
    elif key == keys.LEFT:
        activeEnemy = (activeEnemy + len(enemyImages) - 1) % len(enemyImages)
    elif key == keys.SPACE:
        for enemy in enemies:
            indexEnemy = 0
            direction = 1
            for i in range(len(enemyNames)):
                if enemy.image in enemyNames[i]:
                    indexEnemy = i
                    direction = enemyNames[i].index(enemy.image)
                    break
            print(&quot;(&quot;+str(indexEnemy)+&quot;,&quot;+str(1-direction*2)+&quot;,&quot;+
                  str(round(enemy.pos[0]))+&quot;,&quot;+
                  str(round(enemy.pos[1] + currentY))+&quot;),&quot;)

pgzrun.go()

</code></pre>
</main>

<script>
/*
 * Place platforms on play area
 * - Mouse click: add the current enemy
 * - Mouse secondary click: select next enemy
 * - Cursor Left and Right: select previous or next enemy
 * - Cursor Up and Down: displace the screen
 * - Space: print the enemy positions
 */

const LEVEL_DATA = JSON.parse(document.querySelector('#level').textContent);

const ENEMY_NAMES = ['green_worm_right', 'green_worm_left', 'red_worm_right', 'red_worm_left','bee_1_right', 'bee_1_left'];

var enemies, activeEnemy, currentPosition, currentY;

function reset() {
  enemies = [];

  activeEnemy = 0;
  currentPosition = [0, 0];
  currentY = 0;
}

function draw() {
  screen.clear();
  for (const name of Object.getOwnPropertyNames(LEVEL_DATA['platforms'])) {
    for (let pos of LEVEL_DATA['platforms'][name]['pos']) {
      let actor = new Actor(name);
      actor.posx = pos[0];
      actor.posy = pos[1] - currentY;
      actor.draw();
    }
  }
  for (let enemy of enemies) {
    enemy.draw();
  }
  let actor = new Actor(ENEMY_NAMES[activeEnemy]);
  actor.pos = currentPosition;
  actor.draw();
}

function on_mouse_down(pos, button) {
  if ((button & mouse.LEFT) > 0) {
    let actor = new Actor(ENEMY_NAMES[activeEnemy]);
    actor.pos = currentPosition;
    enemies.push(actor);
  }
  else if ((button & mouse.RIGHT) > 0) {
    activeEnemy = (activeEnemy + 1) % ENEMY_NAMES.length;
  }
}

function on_mouse_move(pos) {
  currentPosition = pos;
}

function on_key_down(key) {
  if (key === keys.UP) {
    currentY -= 100;
    for (let enemy of enemies) {
      enemy.pos = [enemy.pos[0], enemy.pos[1] + 100];
    }
  }
  else if ((key === keys.DOWN) && (currentY < 0)) {
    currentY += 100;
    for (let enemy of enemies) {
      enemy.pos = [enemy.pos[0], enemy.pos[1] - 100];
    }
  }
  else if (key === keys.RIGHT) {
    activeEnemy = (activeEnemy + 1) % ENEMY_NAMES.length;
  }
  else if (key === keys.LEFT) {
    activeEnemy = (activeEnemy + ENEMY_NAMES.length - 1) % ENEMY_NAMES.length;
  }
  else if (key === keys.SPACE) {
    let outputObject = {
      enemies: {},
      platforms: LEVEL_DATA['platforms']
    };
    for (let name of ENEMY_NAMES) {
      outputObject['enemies'][name] = [];
      for (let enemy of enemies) {
        if (enemy.name === name) {
          outputObject['enemies'][name].push([Math.round(enemy.pos[0]), Math.round(enemy.pos[1] + currentY)]);
        }
      }
    }
    console.log(JSON.stringify(outputObject, null, 2));
    output.textContent = JSON.stringify(outputObject, null, 2);
  }
}

window.addEventListener('load', (event) => {
  images.LOAD('#imageLoader img');
  reset();
  screen.set_mode('#screen', '#reset', '#pause');
});
</script>
</body>

</html>
